ðŸ“‚ MASTER_EXECUTION_PLAN.md
Project: JetLag App Feature Expansion & Fixes


Directives:  Strict TDD, Atomic Commits, Agent Protocol Compliance.


ðŸ›‘ TASK 1: FIX VENUE DATES & HISTORY (Data Integrity)
Status: PENDING Priority: CRITICAL Goal: Fix the logic where recurring events show the original start date instead of the next available instance. Hide past bookings.

[COPY & PASTE THIS PROMPT]:

ACT AS MASTER. I need to fix a Critical Logic Bug in the Venue Booking display.

CONTEXT: recurring events currently display the original series creation date (e.g., Jan 2) instead of the actual next booked date (e.g., Jan 9).

INSTRUCTIONS:

TEST RIG: Create a reproduction test case in test/features/venue/ where a booking is made for a recurring event, but the returned object incorrectly reflects the series start date.

ARCHITECT: Analyze the Event/Booking Domain Model. Implement logic to calculate the next_occurrence_date based on the recurrence rule (weekly) relative to DateTime.now().

ARCHITECT: Modify the Booking Repository to strictly filter out bookings where booking_date < DateTime.now() (Hide Past History).

SCRIBE: Update CHANGELOG.md citing 'Fixes Event Date Display Bug'.

DEVOPS: Commit only if tests pass.

ðŸ” TASK 2: PERSISTENT LOGIN & BIOMETRICS (Foundation)
Status: PENDING Priority: HIGH Goal: Implement "Remember Me" and FaceID/TouchID.

[COPY & PASTE THIS PROMPT]:

ACT AS MASTER. I need to upgrade the Authentication Layer with Persistence and Biometrics.

INSTRUCTIONS: 1. LIBRARIAN: Add flutter_secure_storage and local_auth to pubspec.yaml (Fixed versions, no carets). 2. CYBER OFFICER: Review the implementation plan. We must store the auth_token in SecureStorage, NEVER SharedPreferences. 3. ARCHITECT: * Update AuthRepository: On app launch, check SecureStorage for a valid token. * If valid, skip Login Screen. * Implement BiometricService class. If FaceID/TouchID is verified, retrieve the token from SecureStorage to proceed. 4. PLATFORM EXPERT: Ensure NSFaceIDUsageDescription is added to Info.plist for iOS compliance. 5. TEST RIG: Write a test mocking the SecureStorage to verify token retrieval logic.




ðŸ‘¤ TASK 3: PROFILE VIEW & EDIT (Core Feature)
Status: COMPLETED Priority: HIGH Goal: Replicate the "Members Area" web view in Flutter (View + Edit Profile).

[COPY & PASTE THIS PROMPT]:

ACT AS MASTER. I need to implement the User Profile View and Edit features matching the Web Dashboard.

INSTRUCTIONS:

ARCHITECT: Scaffolding for ProfileFeature.

Domain: GetProfileUseCase, UpdateProfileUseCase.

Data: Ensure the repository handles the "Pending Approval" state for edits (if API requires it).

STYLIST: Create UserProfilePage.

Layout: "My Memberships" card on the left/top, "Manage Your Profile" details on the right/bottom. * Brand: Use strict Palette colors. 3. LINGUIST: Ensure labels (Username, Email, Member Number) are in .arb files, not hardcoded.


TEST RIG: Verify that UpdateProfileUseCase correctly maps local edits to the API request payload.

LOGIC: Ensure that any field update via `UpdateProfileUseCase` automatically resets the user's status to `Pending Approval` (e.g., `is_approved: false`) to mandate administrative review.


ðŸ’³ TASK 4: DIGITAL CARD UI UPGRADE (UI Polish)
Status: PENDING Priority: MEDIUM Goal: Update the Digital Card visuals with dynamic Tiers (Gold/Platinum) and new fields.

[COPY & PASTE THIS PROMPT]:

ACT AS MASTER. Update the Digital Membership Card UI Logic and Design.

INSTRUCTIONS:

ARCHITECT: Ensure the User Entity includes: photoUrl, tier_id (3=Gold, 4=Platinum), airline, position, expiryDate, cardId.

STYLIST: Refactor the Card Widget.

Logic: IF tier_id == 4 SHOW "PLATINUM PASSPORT" (text in Platinum Color). IF tier_id == 3 SHOW "GOLD PASSPORT" (text in Gold Color).

Layout: Display Photo, Name, Airline, Position, Expiry (Format: June 30, 2026), and Card ID. 3. PERFORMANCE ANALYST: Ensure the user photo is optimized/cached to prevent jank during card flip or load.

ðŸ“ TASK 5: BENEFITS RENAMING & GEOLOCATION (New Feature)
Status: COMPLETED Priority: MEDIUM Goal: Rename "Partners" to "Benefits", add Country Filter, and Sort by Distance.

[COPY & PASTE THIS PROMPT]:

ACT AS MASTER. Revamp the Benefits (formerly Partners) Tab with Geolocation.

INSTRUCTIONS:

LINGUIST: Global rename of "Our Partners" string to "BENEFITS".

PLATFORM EXPERT: Verify geolocator permissions logic. Handle "User Denied" gracefully as per strict rules.

ARCHITECT: Update BenefitsUseCase.

Input: User Lat/Long.

Logic: Sort benefits by distance from User.

Filter: Add method to filter list by Country.

STYLIST:

Update Header to "BENEFITS".

Add "Country Filter" dropdown.

Show "Distance (km)" on benefit cards if location is active.

ðŸ•µï¸ TASK 6: JETBOSS DASHBOARD (ID7) (Admin Feature)
Status: COMPLETED Priority: LOW Goal: Create a specific view for User ID 7 to manage/download bookings.

[COPY & PASTE THIS PROMPT]:

ACT AS MASTER. Create the JetBoss Dashboard module (ID7 Only).

INSTRUCTIONS:

CYBER OFFICER: Strictly enforce Role-Based Access Control. Only user.id == 7 can access this route.

ARCHITECT: Create JetBossDashboard.

Feature: GetAllBookingsUseCase.

Logic: Filter by Location (Dropdown).

PLATFORM EXPERT: Implement CSVExportService.

Allow saving the filtered booking list as .csv.

Handle Android/iOS file storage permissions.

STYLIST: Create a clean, data-dense table view for the bookings.